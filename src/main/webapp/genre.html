<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¥ë¥´ ì„ íƒ | MovieGuide</title>
  <link rel="stylesheet" href="./css/style.css" />
</head>

<body>

<div class="login-box" style="margin:80px auto; max-width:900px;">

  <h2 class="login-title">ì„ í˜¸í•˜ëŠ” ì¥ë¥´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h2>

  <div class="genre-grid" id="genreGrid"></div>

  <div class="genre-footer">
    <span id="selectionCount" class="warning">
      ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”
    </span>

    <button id="finishBtn" class="login-submit" disabled>
      ì™„ë£Œ
    </button>
  </div>

</div>


<script>
/* =================================
   â­ ì¥ë¥´ ì„ íƒ ë¡œì§
================================= */

let selected = {}; // { genres_id : 1 or 2 }

fetch("/MovieGuide/genre/list")
.then(res => res.json())
.then(data => {

  const grid = document.getElementById("genreGrid");

  data.forEach(g => {

    const card = document.createElement("div");
    card.className = "genre-card";

    card.innerHTML = `
      <span>${g.name}</span>
      <div class="vote">
        <button class="like">ğŸ‘</button>
        <button class="hate">ğŸ‘</button>
      </div>
    `;

    const likeBtn = card.querySelector(".like");
    const hateBtn = card.querySelector(".hate");

    /* ğŸ‘ ì¢‹ì•„ìš” */
    likeBtn.onclick = () => {

      selected[g.id] = 1;

      card.classList.remove("selected-dislike");
      card.classList.add("selected-like");

      updateBtn();
    };

    /* ğŸ‘ ì‹«ì–´ìš” */
    hateBtn.onclick = () => {

      selected[g.id] = 2;

      card.classList.remove("selected-like");
      card.classList.add("selected-dislike");

      updateBtn();
    };

    grid.appendChild(card);
  });
});


function updateBtn(){
  document.getElementById("finishBtn").disabled =
    Object.keys(selected).length === 0;
}


/* ===============================
   ì €ì¥
=============================== */
document.getElementById("finishBtn").onclick = () => {

  fetch("/MovieGuide/genre/select", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(selected)
  })
  .then(()=> location.href="/MovieGuide/index.html");
};

</script>

</body>
</html>
